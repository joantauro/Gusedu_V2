<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./../plantillas/PlantillaPrincipal.xhtml">

            <ui:define name="titulo">
                Inicio
            </ui:define>

            <ui:define name="top">
            
            </ui:define>

            <ui:define name="content">
                        <script type="text/javascript">
		function changeEvent(element) {
			
		    var val = $(element).find('option:selected').text();
		  /*  if(val === 'Datos médicos') {
		       PF('dlgHEA').show();
		    }*/
		    /*if(val === 'Registro de terapia') {
			       PF('dlgT').show();
			}*/
		/*    if(val === 'Venta de productos') {
			       PF('dlgP').show();
			}*/
		    if(val === 'Confirma visita')
		    {
		    	PF('dlgCVi').show();
		    	//document.getElementById('formNuevo:btnAct').click();
		    }
			/*if(val === 'Registro de Pares')
			 {
				PF('dlgParesT').show();
			 }*/
		   /* if(val == 'Caja')
		    	{
		    	PF('dlgpago').show();
		    	}*/
		   /** if(val === 'Historial de visitas') {
			       PF('dlgHV').show();
			}**///Historial Terapias
		/**	if(val === 'Datos Personales') {
				  
				   
			       PF('dlgDP').show(); 
			} **/
		}
		</script>
               
                   <h:form id="formBusquedaP" style="text-align: center;">
			<p:outputLabel value="Filtrar: " for="inpQuery" />
			<p:inputText value="#{pacienteBean.query}" id="inpQuery"
				style="width : 500px;">
				<p:ajax event="keyup" update=":#{p:component('tablaPac')}" delay="250"
					listener="#{pacienteBean.filtrarBusqueda}">
				</p:ajax>
			</p:inputText>
			<p:spacer width="50px;" />
			<p:commandButton value="Nuevo Paciente" id="btnNuevo"
				update=":#{p:component('panelRegistro')}"
				action="#{personaBean.valida}" oncomplete="PF('dlg1').show();" />
		</h:form>
                <br/>
                   <h:form id="formulario">
       
				<p:dataTable id="tablaPac" var="pac"
					value="#{pacienteBean.clientes}" paginator="true" rows="10"
                                        rowKey="#{pac.cliCodigo}" widgetVar="tablaPacientes"
					emptyMessage="No hay historial de visitas por el momento" >

					<p:column headerText="DNI" width="60px;">
                                            <h:outputText value="#{pac.persona.perDni}" />
					</p:column>

					<p:column headerText="Ap. paterno"   >
                                            <h:outputText value="#{pac.persona.perApellidoP}" />
					</p:column>

					<p:column headerText="Ap. materno"   >
                                            <h:outputText value="#{pac.persona.perApellidoM}" />
					</p:column>

					<p:column headerText="Nombre"  >
                                            <h:outputText value="#{pac.persona.perNombres}" />
					</p:column>

					<p:column headerText="Edad" width="25px;" >
						<h:outputText value="#{pac.persona.perEdad}" rendered="#{pac.persona.perEdad ne 0}"  />
						<h:outputText value="" rendered="#{pac.persona.perEdad eq 0}"  />
					</p:column>
					
					<p:column headerText="Teléfono fijo" width="60px;" >
                                            <h:outputText value="#{pac.persona.perTelFijo}"></h:outputText>
					</p:column>
					<p:column headerText="Teléfono móvil" width="70px;">
                                            <h:outputText value="#{pac.persona.perTelMovil}"></h:outputText>
					</p:column>

					
					<p:column headerText="Opciones"> 
                                            <p:selectOneMenu id="sselectoption" value="#{visitaBean.opciones}" onchange="changeEvent(this)"  >
						<f:selectItem itemLabel="Seleccione" itemValue="S" />
						<f:selectItem itemLabel="Crear visita" itemValue="CV"  />
						<f:selectItem itemLabel="Datos médicos" itemValue="DM"  />
						<f:selectItem itemLabel="Registro de Terapia" itemValue="RGT"  />
						<f:selectItem itemLabel="Registro de Pares" itemValue="RGPT" />
                                                <f:selectItem itemLabel="Venta de productos" itemValue="P" itemDisabled="#{auth.userLogged.tipoUsuario.ventaProductos eq false}" />
						<!-- <f:selectItem itemLabel="Editar Datos Clinicos" itemValue="DC" />-->
						<f:selectItem itemLabel="Historial de terapias" itemValue="HT"   />
						<f:selectItem itemLabel="Historial de visitas" itemValue="HV" />
						<f:selectItem itemLabel="Datos Personales" itemValue="DP" />
						 
				<!--		<f:selectItem itemLabel="Confirma visita" itemValue="CVi" /> -->
                                <p:ajax event="change" update=":#{p:component('frame')},:#{p:component('growl')}"
                                                     listener="#{pacienteBean.prueba(pac)}" /> 
					</p:selectOneMenu>
					</p:column>
				</p:dataTable>
			</h:form>
                <p:growl id="growlT" showDetail="true"   life="2000" /> 
                <p:dialog id="iddlgTerapeutas" header="Registrar Terapia" widgetVar="dlgTerapeutas" modal="true" >
			<p:ajax event="close" update=":#{p:component('tablaPac')}" listener="#{visitaBean.probando}" />
			
                        <p:outputLabel value="Paciente : #{pacienteBean.cliente.persona.perNombres} #{pacienteBean.cliente.persona.perApellidoP} #{pacienteBean.cliente.persona.perApellidoM}" />
			 <h:form>
			  
			 <p:panelGrid columns="2" >
					<p:outputLabel value="Tipo de Terapia : " />
					<p:selectOneMenu id="iTipoTerapia2"
						value="#{terapiaBean.idterapia}"  >
						<f:selectItem itemLabel="Seleccione un tipo" itemValue="0" />
						<f:selectItems value="#{terapiaBean.tipoTerapias}" var="tt"
							itemValue="#{tt.tteCodigo}" itemLabel="#{tt.tteNombre}" />
					</p:selectOneMenu>
					<p:outputLabel value="Terapeuta : " />
					<p:selectOneMenu id="prueba" value="#{terapiaBean.idterapeuta}" >
						<f:selectItem itemLabel="Seleccione Terapeuta" itemValue="0" />
						<f:selectItems value="#{personaBean.listaTerapeutas}" var="tte"
                                                               itemValue="#{tte.perNombres} #{tte.perApellidoP} #{tte.perApellidoM}"
							itemLabel="#{tte.perNombres} #{tte.perApellidoP} #{tte.perApellidoM}" />
					</p:selectOneMenu>
					
					<p:outputLabel value="Costo : " />
					<p:inputText value="#{terapiaBean.precio}"  />					
				</p:panelGrid>
 
			
				<p:commandButton value="Registrar" id="disparador"
                                                 actionListener="#{terapiaBean.addTerapiaSP}" oncomplete="PF('dlgTerapeutas').hide();" update=":#{p:component('growl')}"  />
				</h:form>
			</p:dialog>
                
                
       
                
                <p:dialog  id="dialoghistorialTerapia" header="Historia" widgetVar="dlgHTe" 
		        showEffect="pop" modal="true" width="1230px" height="550px">
		        <p:ajax event="close" update=":#{p:component('tablaPac')}" listener="#{visitaBean.probando}" />
			<h:form id="frame5"  >
				<ui:include src="HistorialTerapia.xhtml" />
			</h:form>
		</p:dialog>
                <p:dialog id="dialogParesv2" header="Registar Pares" widgetVar="dlgParesT" showEffect="pop"  width="80%"  >
		<p:ajax event="close"
			 update=":#{p:component('tablaPac')}" 
			 listener="#{terapiaBean.aceptar}"  />
			 <h:form id="frame10">
			       <ui:include src="RegistroParesV2.xhtml" />
		 
			</h:form>
		</p:dialog>
                
                <p:dialog id="dialogProducto" header="Productos" widgetVar="dlgP"
				showEffect="pop" modal="true" width="850px" height="550px">
				<p:ajax event="close" update=":#{p:component('tablaPac')}" 
				listener="#{visitaBean.probando}" />
			<h:form id="formProduct" >
				<ui:include src="Producto.xhtml" />
				</h:form>
			</p:dialog>
                
                
                <p:dialog id="dialogHistorialVisitas" header="Historial de Visitas" 
			widgetVar="dlgHV" showEffect="pop" modal="true" width="800px" height="550px" >
			<p:ajax event="close" update=":#{p:component('tablaPac')}" listener="#{visitaBean.probando}" />
			<h:form id="frame4"  >
				<ui:include src="historialVisitas.xhtml" />

			</h:form>
		</p:dialog>
                
                <p:dialog id="dialogDP" widgetVar="dlgDP" showEffect="pop" modal="true"   >
<p:ajax event="close" update=":#{p:component('tablaPac')}" listener="#{visitaBean.probando}" />
	<h:form id="frame" >
		<ui:include  src="editarDatosPersonales.xhtml"  />
	</h:form>
</p:dialog>
                
                <p:dialog id="dialogHEA" header="Historia" widgetVar="dlgHEA"
				showEffect="pop" modal="true" width="850px" height="500px">
				<p:ajax event="close" update=":#{p:component('tablaPac')}" listener="#{visitaBean.probando}" />
			
				<h:form id="frame2" >
				<ui:include src="HEA.xhtml" />
				</h:form>
				
			</p:dialog>
                
                <h:form>
			<p:dialog id="dialog" header="Nuevo Paciente" widgetVar="dlg1"
				showEffect="pop" modal="true">
				<ui:include src="prueba.xhtml" />
			</p:dialog>
		</h:form>
                
            </ui:define>

            <ui:define name="bottom">
               
            </ui:define>

        </ui:composition>

    </body>
</html>
