<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:pe="http://primefaces.org/ui/extensions">

    <body>

        <ui:composition template="./../plantillas/PlantillaPrincipal.xhtml">

            <ui:define name="titulo">
                Calendario de Citas
            </ui:define>

            <ui:define name="top">
              
            </ui:define>

            <ui:define name="content">
      
           <p:growl id="messages" showDetail="true" />
           
           <p:panelGrid columns="2" >
               <h:form> 
                         <h:panelGrid columnClasses="value">
        <h3 style="margin-top: 0">Calendario de Citas</h3>
        <p:schedule id="schedule" value="#{scheduleView.eventModel}" view="agendaWeek"
                    widgetVar="myschedule" timeZone="GMT-5" locale="es"   > 

            <p:ajax  event="dateSelect" listener="#{scheduleView.before}" update=":#{p:component('eventDetails')},:#{p:component('messages')}"   />
            <p:ajax event="eventSelect" listener="#{scheduleView.onEventSelect}"  update=":#{p:component('eventDetails2')}" oncomplete="PF('eventDialog2').show();" />
            <p:ajax event="eventMove" listener="#{scheduleView.onEventMove}" update=":#{p:component('messages')}" />
            <p:ajax event="eventResize" listener="#{scheduleView.onEventResize}" update=":#{p:component('messages')}" />
 
        </p:schedule>
    </h:panelGrid>
               </h:form>
              
               <h:form>
                    <p:commandButton value="Nuevo Paciente" id="btnNuevoC" 	
				action="#{personaBean.valida}" oncomplete="PF('dlg1').show();" 
                                styleClass="ui-priority-primary" />
                    <br/>
                    <br/>
                   <p:selectOneListbox id="basic" value="#{scheduleView.codigo}" filter="true" filterMatchMode="contains" style="width: 300px;" scrollHeight="600"  >
                       <f:selectItems value="#{pacienteBean.clientes}" var="theme" 
                                      itemLabel="#{theme.persona.perNombres} #{theme.persona.perApellidoP} #{theme.persona.perApellidoM}" 
                                      itemValue="#{theme.cliCodigo}" />
                       <p:ajax    listener="#{scheduleView.paciente()}" /> 
                   </p:selectOneListbox>
              
               </h:form>
          
                           
           </p:panelGrid>
         
            
               <h:form>
                   <p:growl showDetail="true" autoUpdate="true" />
                    <p:dialog id="dialogCalendar" header="Nuevo Paciente" widgetVar="dlg1"
				showEffect="pop" modal="true">
				
                        
                        
                        <p:panel id="panelJ" style="height: 500px" >
                    <p:panelGrid columns="2" id="panelRegistro"  >
			<p:outputLabel for="perDni" value="DNI: " />
                        <p:inputText value="#{personaBean.persona.perDni}" id="perDni" maxlength="8" required="true" requiredMessage="El campo DNI es obligatorio" >
				<pe:keyFilter mask="num" />  
			</p:inputText>

			<p:outputLabel for="perNombre" value="Nombre: " />
                        <p:inputText value="#{personaBean.persona.perNombres}" id="perNombre" required="true" requiredMessage="Se requiere llenar el nombre" >

			</p:inputText>

			<p:outputLabel for="perApePaterno" value="Apellido paterno: " />
                        <p:inputText value="#{personaBean.persona.perApellidoP}" required="true" requiredMessage="Se requiere llenar los apellidos"
				id="perApePaterno" >
	
			</p:inputText>

			<p:outputLabel for="perApeMaterno" value="Apellido materno: " />
			<p:inputText value="#{personaBean.persona.perApellidoM}" 
				id="perApeMaterno" >
			
			</p:inputText>

			<p:outputLabel for="perEdad" value="Edad : " />
                        <p:inputText value="#{personaBean.persona.perEdad}" id="perEdad" maxlength="3"   validatorMessage="Solo se aceptan numeros positivos" >
				<pe:keyFilter mask="num" /> 
				<f:validateDoubleRange minimum="0" maximum="250" />
			</p:inputText>
			
			<p:outputLabel for="perFecNac" value="Fecha de nacimiento: " /> 
                        <p:calendar value="#{personaBean.persona.perFecNacimiento}" yearRange="c-100:c" maxdate="new Date();"
				id="perFecNac" pattern="dd/MM/yyyy" navigator="true" />

			<p:outputLabel for="perTelFijo" value="Teléfono fijo: " />
                        <p:inputText	id="perTelFijo"  value="#{personaBean.persona.perTelFijo}" />
			
			
			
                        <p:outputLabel for="perTelMovil" value="Teléfono móvil: " />
			<p:inputText type="tel" 
                                     value="#{personaBean.persona.perTelMovil}" id="perTelMovil" maxlength="12" >
				<pe:keyFilter mask="num" />  
			</p:inputText>
                        
                        
                        <p:outputLabel value="Departamento : " />
                        <p:selectOneMenu id="idDepa" 
                                         value="#{ubigoBean.idDepartamento}"
                                         requiredMessage="Seleccionar un departamento" >
                            <f:selectItem itemLabel="Seleccione un tipo" itemValue="#{null}" />
                            <f:selectItems value="#{ubigoBean.listadepa}" var="tt"
                                           itemValue="#{tt.idDepa}" itemLabel="#{tt.departamento}" />
                            <p:ajax event="change" 
                                    update=":#{p:component('idProv')},
                                    :#{p:component('idDis')}"
                                    listener="#{ubigoBean.LISTA_PROVINCIAS()}" 
                                    />
                        </p:selectOneMenu>
                        
                        <p:outputLabel value="Provincia : " />
                        <p:selectOneMenu id="idProv" 
                 value="#{ubigoBean.idProvincia}"
                                        requiredMessage="Seleccionar una provincia" >
                           <f:selectItem itemLabel="Seleccione un tipo" itemValue="#{null}" />
                           <f:selectItems value="#{ubigoBean.listapro}" var="u_prov"
                                          itemValue="#{u_prov.idProv}" itemLabel="#{u_prov.provincia}" />
                           <p:ajax event="change" 
                                    update=":#{p:component('idDis')}"
                                    listener="#{ubigoBean.LISTA_DISTRITO()}" 
                                   />
                       </p:selectOneMenu>
                        
                        <p:outputLabel value="Distrito : " />
                        <p:selectOneMenu id="idDis" 
                                         value="#{ubigoBean.idDistrito}"
                                         requiredMessage="Seleccionar un Distrito" >
                            <f:selectItem itemLabel="Seleccione un tipo" itemValue="#{null}" />
                            <f:selectItems value="#{ubigoBean.listadis}" var="u_dis"
                                           itemValue="#{u_dis.idDist}" itemLabel="#{u_dis.distrito}" />
                        </p:selectOneMenu>
                        
			<p:outputLabel for="perDireccion" value="Dirección: " />
                        <p:inputText value="#{personaBean.persona.perDireccion}" id="perDireccion" style="width: 310px"   />
			

			

			<p:outputLabel for="perCorreo" value="Correo: " />
                        <p:inputText value="#{personaBean.persona.perCorreo}" id="perCorreo" style="width: 310px"    >
				<f:validateRegex
					pattern="^((?:(?:(?:[a-zA-Z0-9][\.\-\+_]?)*)[a-zA-Z0-9])+)\@((?:(?:(?:[a-zA-Z0-9][\.\-_]?){0,62})[a-zA-Z0-9])+)\.([a-zA-Z0-9]{2,6})$" />
			</p:inputText>

			<p:outputLabel for="perSexo" value="Sexo: " />
                        <p:selectOneButton id="perSexo" value="#{personaBean.persona.perSexo}">
				<f:selectItem itemLabel="Masculino" itemValue="M" />
				<f:selectItem itemLabel="Femenino" itemValue="F" />
			</p:selectOneButton>

			<p:outputLabel for="perEstadoCivil" value="Estado civil: " />
			<p:selectOneButton id="perEstadoCivil"
                                           value="#{personaBean.persona.perEstadoCivil}">
				<f:selectItem itemLabel="Soltero" itemValue="Soltero" />
				<f:selectItem itemLabel="Casado" itemValue="Casado" />
				<f:selectItem itemLabel="Viudo" itemValue="Viudo" />
				<f:selectItem itemLabel="Divorciado" itemValue="Divorciado" />
			</p:selectOneButton>

			<p:outputLabel for="perComo" value="¿Cómo se enteró de Gusedu?" />
                        <p:selectOneRadio id="perComo" value="#{personaBean.persona.perEnteroGusedu}" layout="grid" columns="2" >
				<f:selectItem itemLabel="Medios de comunicacion" itemValue="Medios de comunicacion" />
				<f:selectItem itemLabel="Web" itemValue="Web" />
				<f:selectItem itemLabel="Amigos" itemValue="Amigos" />
				<f:selectItem itemLabel="Familiares" itemValue="Familiares" />
				<f:selectItem itemLabel="Publicidad" itemValue="Publicidad" />
			</p:selectOneRadio>

                        <p:commandButton id="proceReg" value="Registrar"   
                                         action="#{personaBean.registroPacienteV2()}" 
                                         update=":#{p:component('basic')}"
                                         icon="ui-icon-check"    />
                        
			<p:commandButton value="Cancelar" icon="ui-icon-cancel"
				action="#{personaBean.cancel}" immediate="true" />
		</p:panelGrid>
                </p:panel>
                        
                        
                        
	             </p:dialog>
               </h:form>
           
           <h:form id="formCalendario" >
               <p:dialog widgetVar="eventDialog" id="eventDialogP" header="Detalle de Cita" 
                         showEffect="clip" hideEffect="clip" modal="true" >
                   <p:panel id="pnlCitas" >
                   <h:panelGrid id="eventDetails" columns="2">
                       <p:outputLabel for="title" value="Paciente : " />
                       <p:outputLabel id="title" value="#{scheduleView.cli.persona.perNombres} #{scheduleView.cli.persona.perApellidoP} #{scheduleView.cli.persona.perApellidoM}"  />

                       <p:outputLabel for="from" value="Desde :" />
                       <p:calendar id="from" value="#{scheduleView.visita.visFecCreacion}" timeZone="GMT-5" pattern="dd/MM/yyyy HH:mm"/>

                       <p:outputLabel for="to" value="Hasta :" />
                       <p:calendar id="to" value="#{scheduleView.visita.visFecFin}" timeZone="GMT-5" pattern="dd/MM/yyyy HH:mm"/>

                       <p:outputLabel for="iTipoTerapia2" value="Tipo de Terapia : " />
                       <p:selectOneMenu id="iTipoTerapia2" 
                                        value="#{scheduleView.terapia.tipoTerapia.tteCodigo}" 
                                        required="true" requiredMessage="Seleccionar una Terapia" >
                           <f:selectItem itemLabel="Seleccione un tipo" itemValue="#{null}" />
                           <f:selectItems value="#{terapiaBean.tipoTerapias}" var="tt"
                                          itemValue="#{tt.tteCodigo}" itemLabel="#{tt.tteNombre}" />                         
                       </p:selectOneMenu>
                      
                       <p:outputLabel for="prueba" value="Terapeuta : " />
                       <p:selectOneMenu id="prueba" value="#{scheduleView.terapia.terUsuCreacion}" required="true" requiredMessage="Requiere que seleccione un terapeuta" >
                           <f:selectItem itemLabel="Seleccione Terapeuta" itemValue="#{null}" />
                           <f:selectItems value="#{personaBean.listaTerapeutas}" var="tte"
                                          itemValue="#{tte.perNombres} #{tte.perApellidoP} #{tte.perApellidoM}|#{tte.perCodigo}"
                                          itemLabel="#{tte.perNombres} #{tte.perApellidoP} #{tte.perApellidoM}" />
                           
                           
                           
                       </p:selectOneMenu>

                       <p:outputLabel value="Observación : " />
                       <p:inputTextarea value="#{scheduleView.visita.visDescripcion}"  />

                       <p:commandButton id="addButton" value="Guardar" actionListener="#{scheduleView.addEvent}" oncomplete="if (args &amp;&amp; !args.validationFailed) PF('myschedule').update();if (args &amp;&amp; !args.validationFailed)PF('eventDialog').hide();" update=":#{p:component('eventDetails')}" />
                       <p:commandButton actionListener="#{scheduleView.cancel()}" value="Cancelar"  />
                        <f:facet name="footer">
                            <p:message for="iTipoTerapia2" />
                            <p:message for="prueba" />
                        </f:facet>
 
                       
                     
                   </h:panelGrid>
                   </p:panel>
               </p:dialog>  
               
               <p:dialog widgetVar="eventDialog2" header="Detalle de Cita" showEffect="clip" hideEffect="clip">
                   <h:panelGrid id="eventDetails2" columns="2"  cellspacing="10"  >
                       <p:outputLabel for="title2" value="Paciente : " />
                       <p:outputLabel id="title2" value="#{scheduleView.cli.persona.perNombres} #{scheduleView.cli.persona.perApellidoP} #{scheduleView.cli.persona.perApellidoM}"  />

                       <p:outputLabel for="from2" value="Fecha :" />
                       <p:outputLabel id="from2" value="#{scheduleView.visita.visFecCreacion}" >
                           <f:convertDateTime pattern="dd/MM/yyyy " />
                       </p:outputLabel>
                       
                       
                       <p:outputLabel  value="Hora :" />
                       
               
                       
                       <p:panelGrid    >
                           <p:outputLabel value="#{scheduleView.visita.visFecCreacion}" >
                               <f:convertDateTime pattern="hh:mm a" />
                           </p:outputLabel>
                           <p:outputLabel value=" - " />
                           <p:outputLabel  value="#{scheduleView.visita.visFecFin}"  >
                               <f:convertDateTime pattern="hh:mm a"  />
                           </p:outputLabel>
                       </p:panelGrid>
                       
                       
                       
                       <p:outputLabel value="Tipo de Terapia : " />
                       <p:outputLabel value="#{scheduleView.terapia.tipoTerapia.tteNombre}" />

                       <p:outputLabel value="Terapeuta : " />
                       <p:outputLabel value="#{scheduleView.terapia.terUsuCreacion}" />

                       <p:outputLabel value="Descripción : " />
                       <h:outputLabel value="#{scheduleView.visita.visDescripcion}" />

                       <p:commandButton id="addButton2" value="Cerrar" action="#{scheduleView.cleaner()}" oncomplete="PF('myschedule').update();PF('eventDialog2').hide();"  />

                   </h:panelGrid>
               </p:dialog>  
               <p:blockUI block=":#{p:component('pnlCitas')}" trigger=":#{p:component('addButton')}" />
           </h:form> 
          
           <script type="text/javascript">
		PrimeFaces.locales["es"] = {
			    closeText: "Cerrar",
			    prevText: "Anterior",
			    nextText: "Siguiente",
			    monthNames: ["Enero","Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
			    monthNamesShort: ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
			    dayNames: ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"],
			    dayNamesShort: ["Dom", "Lun", "Mar", "Mie", "Jue", "Vie", "Sab"],
			    dayNamesMin: ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa"],
			    weekHeader: "Semana",
			    firstDay: 0,
			    isRTL: false,
			    showMonthAfterYear: false,
			    yearSuffix: "",
			    timeOnlyTitle: "Solo hora",
			    timeText: "Tiempo",
			    hourText: "Hora",
			    minuteText: "Minuto",
			    secondText: "Segundo",
			    currentText: "Fecha actual",
			    ampm: false,
			    month: "Mes",
			    week: "Semana",
			    day: "Día",
			    allDayText : "Todo el día"
			};
</script>
<style type="text/css">
    .value {
        width: 650px;
    }
</style>
            </ui:define>

            <ui:define name="bottom">
             
            </ui:define>

        </ui:composition>

    </body>
</html>
